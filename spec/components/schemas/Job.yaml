type: object
properties:
  id:
    type: integer
    description: 任务ID
  type:
    type: string
    enum: 
      - test
      - build
      - deploy
    description: 任务类型
  services:
    type: array
    description: 任务类型为deploy时,最多只能有一个service
    items:
      type: object
      properties:
        id:
          type: integer
          description: 服务ID
        name:
          type: string
          description: 服务名称
  timeout:
    type: integer
    description: 超时时间(秒)
  vars:
    description: 自定义变量
    type: array
    items:
      type: object
      properties:
        key:
          type: string
          description: '变量名称 [a-z][a-z0-9A-Z_\-]+'
        value:
          type: string
          description: 值
        secured:
          type: boolean
          description: 是否敏感信息
  buildConf:
    type: object
    description: 构建任务配置
    properties:
      caches:
        type: array
        items:
          type: string
      scripts:
        description: 运行脚本
        type: array
        items:
          type: string
      packaging:
        type: object
        description: |
          打包方式.
          如打包成压缩文件 apache-tomcat-8.5.38.tar.gz, 则name=apache-tomcat, versioning=custom, version=8.5.38, type=tar
          如打包成镜像 registry.example.com/foo/bar:20190101121100, 则name=foo/bar, versioning=timestamp, type=image
        properties:
          type:
            type: string
            enum:
              - image
              - zip
              - tar
            description: image表示打包成镜像，tar和zip表示打包成压缩文件
          name:
            type: string
            description: 打包名称前缀, 如 tomcat
          versioning:
            type: string
            enum:
              - ref
              - timestamp
              - custom
            description: 包版本生成模式，ref表示依赖代码库的分支或者tag名称, custom为自定义版本号
          version:
            type: string
            description: 自定义版本号
      repository:
        type: object
        description: 代码库
        properties:
          codehost:
            type: object
            properties:
              id:
                type: integer
                description: 代码库ID
              address:
                type: string
                description: 代码库地址
              type:
                type: string
                enum: ['gitlab', 'github']
          namespace:
            type: string
            description: 命名空间 (user/group)
          name:
            type: string
            description: 代码库名称
          branch:
            type: string
            description: 分支名
          submodule:
            type: boolean
            description: 是否同步子模块
          preClear:
            type: boolean
            description: 是否在同步代码前清空子目录
  deployConf:
    type: object
    description: 部署配置
    properties:
      containerized:
        type: boolean
        description: 容器化部署
      scripts:
        description: 运行脚本 (仅当containerized=false时有效)
        type: array
        items:
          type: string
      k8sTemplates:
        description: k8syaml文件 (仅当containerized=true时有效)
        type: array
        items:
          type: string
      useLatestArtifact:
        type: boolean
        description: 使用最新的应用包
      artifact:
        $ref: "#/components/schemas/Artifact"
        description: 仅当useLatestArtifact=false时有效
